# Satellite Imagery Directory

This directory contains Sentinel-2 satellite imagery and derived products (embeddings).

## Directory Structure

```
img/
├── sentinel2/
│   ├── mexico/           # Mexican agricultural zones
│   │   ├── mexicali/     # Valle de Mexicali
│   │   ├── bajio/        # Bajío, Guanajuato
│   │   └── sinaloa/      # Valle de Culiacán
│   ├── embeddings/       # Extracted embeddings (.npz files)
│   └── hls_bands/        # Individual HLS bands
└── README.md             # This file
```

## Important Notes

### Git Ignore

**This directory is excluded from Git** due to large file sizes (~6GB total).

The `.gitignore` file excludes:
- `img/sentinel2/` - Satellite imagery
- `*.npz` - Embedding files
- `*.tif`, `*.png`, `*.jpg` - Image files

### How to Obtain Imagery

To download satellite imagery for your analysis:

#### 1. Configure Sentinel Hub Credentials

You need a free Sentinel Hub account:

1. Register at https://www.sentinel-hub.com/
2. Create a configuration and obtain:
   - `CLIENT_ID`
   - `CLIENT_SECRET`

3. Set environment variables:
```bash
export SENTINELHUB_CLIENT_ID="your_client_id"
export SENTINELHUB_CLIENT_SECRET="your_client_secret"
```

Or create `sentinelhub-secrets_.txt` in project root:
```
your_client_id
your_client_secret
```

#### 2. Download Imagery

**Option A: Download all Mexican zones (recommended)**
```bash
python scripts/redownload_with_recent_dates.py
```

This downloads imagery from the last 30 days for all 3 zones.

**Option B: Download specific zone**
```bash
python scripts/download_hls_image.py --zone mexicali
python scripts/download_hls_image.py --zone bajio
python scripts/download_hls_image.py --zone sinaloa
```

**Option C: Download with specific date range**
```bash
python scripts/download_hls_image.py --zone mexicali --date-from 2024-10-01 --date-to 2024-10-31
```

#### 3. Verify Download

Check that images contain valid data:
```bash
python scripts/diagnose_sentinel_data.py
```

### File Formats

- **HLS bands**: `.npy` files (NumPy arrays)
  - Individual bands: `B02_10m.npy`, `B03_10m.npy`, etc.
  - Stacked HLS: `hls_image.npy` (6 bands)
  
- **Embeddings**: `.npz` files (compressed NumPy)
  - Contains embeddings + metadata
  - Generated by Prithvi model

- **Metadata**: `metadata.txt`
  - Download information
  - Date range, bbox, dimensions

### Typical Sizes

- Single zone HLS image: ~50-100 MB
- Single zone embeddings: ~200-300 MB
- All 3 zones complete: ~2 GB

### Troubleshooting

**Problem: Downloaded images contain only zeros**

This means no valid imagery is available for the specified date/area.

Solutions:
1. Use a wider date range (30 days recommended)
2. Try different dates
3. Verify area has Sentinel-2 coverage
4. Check cloud coverage settings

**Problem: Download fails with authentication error**

Solutions:
1. Verify credentials are correct
2. Check Sentinel Hub account is active
3. Ensure environment variables are set

**Problem: Out of memory**

Solutions:
1. Download zones one at a time
2. Reduce image resolution
3. Use smaller bounding boxes

## Data Sources

- **Satellite**: Sentinel-2 L2A (ESA Copernicus)
- **API**: Sentinel Hub
- **Model**: Prithvi-EO-1.0-100M (NASA/IBM)

## References

- Sentinel Hub: https://www.sentinel-hub.com/
- Sentinel-2: https://sentinels.copernicus.eu/web/sentinel/missions/sentinel-2
- Prithvi Model: https://huggingface.co/ibm-nasa-geospatial/Prithvi-EO-1.0-100M
