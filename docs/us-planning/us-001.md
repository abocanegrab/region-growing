# US-001: Migrar Backend de Flask a FastAPI + Poetry

## ğŸ“‹ InformaciÃ³n General

**Epic:** FundaciÃ³n y Baseline (DÃ­as 1-3)  
**Prioridad:** Alta (Bloqueante)  
**EstimaciÃ³n:** 4 horas  
**Responsable:** Carlos Bocanegra  
**Estado:** â³ Pendiente  

---

## ğŸ¯ Historia de Usuario

**Como** desarrollador  
**Quiero** migrar el backend de Flask a FastAPI y configurar Poetry  
**Para que** tengamos mejor performance, documentaciÃ³n automÃ¡tica y gestiÃ³n de dependencias moderna

---

## âœ… Criterios de AceptaciÃ³n

### 1. Poetry Configurado
- [x] `pyproject.toml` creado con metadatos del proyecto
- [x] `poetry.lock` generado para reproducibilidad
- [x] Entorno virtual automÃ¡tico funcionando
- [x] Todas las dependencias actuales migradas
- [x] Grupos de dependencias separados (main, dev, test)

### 2. FastAPI Funcionando
- [x] AplicaciÃ³n FastAPI inicializada correctamente
- [x] Todos los endpoints REST migrados y funcionando
- [x] Swagger docs automÃ¡tico en `/api/docs`
- [x] ReDoc alternativo en `/api/redoc`
- [x] Health check endpoint operativo

### 3. ValidaciÃ³n con Pydantic
- [x] Modelos Pydantic para requests implementados
- [x] Modelos Pydantic para responses implementados
- [x] ValidaciÃ³n automÃ¡tica de datos de entrada
- [x] Mensajes de error descriptivos

### 4. CORS Configurado
- [x] CORS habilitado para Nuxt 3 (puerto 3000)
- [x] ConfiguraciÃ³n flexible desde variables de entorno
- [x] Soporte para mÃºltiples orÃ­genes si es necesario

### 5. Estructura de Proyecto Limpia
- [x] Estructura modular: `app/`, `config/`, `tests/`
- [x] SeparaciÃ³n clara de responsabilidades
- [x] CÃ³digo siguiendo estÃ¡ndares AGENTS.md
- [x] Sin cÃ³digo duplicado

---

## ğŸ—ï¸ AnÃ¡lisis de la SituaciÃ³n Actual

### Estado del Backend Actual (Flask)

**Estructura existente:**
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py              # Factory Flask con CORS
â”‚   â”œâ”€â”€ controllers/             # Endpoints REST
â”‚   â”œâ”€â”€ services/                # LÃ³gica de negocio
â”‚   â”œâ”€â”€ entities/                # Modelos (vacÃ­o)
â”‚   â””â”€â”€ utils/                   # Utilidades
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.py                # ConfiguraciÃ³n desde .env
â”œâ”€â”€ app.py                       # Punto de entrada
â””â”€â”€ requirements.txt             # Dependencias pip
```

**Dependencias actuales (requirements.txt):**
- Flask 3.0+
- flask-cors 4.0+
- flasgger 0.9+ (Swagger para Flask)
- sentinelhub 3.10+
- numpy 2.3+
- opencv-python 4.9+
- scipy 1.11+
- shapely 2.0+
- pyproj 3.6+
- geojson 3.0+
- python-dotenv 1.0+

**Endpoints existentes:**
1. `GET /health` - Health check
2. `GET /api/analysis/test` - Test Sentinel Hub
3. `POST /api/analysis/analyze` - AnÃ¡lisis de regiÃ³n


### Ventajas de FastAPI sobre Flask

| Aspecto | Flask | FastAPI |
|---------|-------|---------|
| **Performance** | WSGI (sÃ­ncrono) | ASGI (asÃ­ncrono) - 3-4x mÃ¡s rÃ¡pido |
| **DocumentaciÃ³n** | Manual (flasgger) | AutomÃ¡tica (OpenAPI nativo) |
| **ValidaciÃ³n** | Manual o extensiones | Pydantic integrado |
| **Type Hints** | Opcional | Obligatorio y aprovechado |
| **Async/Await** | No nativo | Nativo y optimizado |
| **Testing** | unittest/pytest | TestClient integrado |
| **ProducciÃ³n** | Gunicorn/uWSGI | Uvicorn (mÃ¡s moderno) |

**JustificaciÃ³n tÃ©cnica:**
- Las llamadas a Sentinel Hub API son I/O bound â†’ async mejora performance
- ValidaciÃ³n automÃ¡tica reduce bugs y mejora DX
- Swagger/ReDoc sin configuraciÃ³n adicional
- Mejor preparado para escalar (futuro deployment)

---

## ğŸ“ DiseÃ±o de la SoluciÃ³n

### Arquitectura Propuesta

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                  # FastAPI app (reemplaza __init__.py)
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ health.py        # Health check endpoints
â”‚   â”‚   â”‚   â””â”€â”€ analysis.py      # Analysis endpoints
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ requests.py      # Pydantic request models
â”‚   â”‚       â””â”€â”€ responses.py     # Pydantic response models
â”‚   â”œâ”€â”€ services/                # Mantener servicios existentes
â”‚   â”‚   â”œâ”€â”€ region_growing_service.py
â”‚   â”‚   â”œâ”€â”€ sentinel_hub_service.py
â”‚   â”‚   â”œâ”€â”€ ndvi_service.py
â”‚   â”‚   â”œâ”€â”€ region_growing_algorithm.py
â”‚   â”‚   â””â”€â”€ geo_converter_service.py
â”‚   â””â”€â”€ utils/                   # Mantener utilidades
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.py                # Migrar a Pydantic Settings
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_health.py
â”‚   â””â”€â”€ test_analysis.py
â”œâ”€â”€ pyproject.toml               # Poetry config (NUEVO)
â”œâ”€â”€ poetry.lock                  # Lock file (NUEVO)
â”œâ”€â”€ app.py                       # Punto de entrada (actualizar)
â””â”€â”€ README.md                    # Actualizar documentaciÃ³n
```

### Cambios Clave

#### 1. ConfiguraciÃ³n con Pydantic Settings

**Antes (Flask):**
```python
# config/config.py
import os
from dotenv import load_dotenv

class Config:
    FLASK_ENV = os.getenv('FLASK_ENV', 'development')
    PORT = int(os.getenv('FLASK_PORT', 5000))
    # ...
```

**DespuÃ©s (FastAPI):**
```python
# config/config.py
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    model_config = SettingsConfigDict(
        env_file='.env',
        env_file_encoding='utf-8',
        case_sensitive=False
    )
    
    # App
    app_name: str = "Sistema HÃ­brido de DetecciÃ³n de EstrÃ©s Vegetal"
    app_version: str = "2.0.0"
    debug: bool = False
    port: int = 8000
    
    # CORS
    cors_origins: list[str] = ["http://localhost:3000"]
    
    # Sentinel Hub
    sentinel_hub_client_id: str
    sentinel_hub_client_secret: str
```


#### 2. Schemas Pydantic

**Requests:**
```python
# app/api/schemas/requests.py
from pydantic import BaseModel, Field, field_validator
from datetime import date
from typing import Optional

class BBoxRequest(BaseModel):
    min_lat: float = Field(..., ge=-90, le=90, description="Latitud mÃ­nima")
    min_lon: float = Field(..., ge=-180, le=180, description="Longitud mÃ­nima")
    max_lat: float = Field(..., ge=-90, le=90, description="Latitud mÃ¡xima")
    max_lon: float = Field(..., ge=-180, le=180, description="Longitud mÃ¡xima")
    
    @field_validator('max_lat')
    def validate_lat_order(cls, v, info):
        if 'min_lat' in info.data and v <= info.data['min_lat']:
            raise ValueError('max_lat debe ser mayor que min_lat')
        return v

class AnalysisRequest(BaseModel):
    bbox: BBoxRequest
    date_from: Optional[str] = Field(None, description="Fecha inicio (YYYY-MM-DD)")
    date_to: Optional[str] = Field(None, description="Fecha fin (YYYY-MM-DD)")
    method: str = Field("classic", description="MÃ©todo: classic o hybrid")
```

**Responses:**
```python
# app/api/schemas/responses.py
from pydantic import BaseModel
from typing import Dict, Any

class Statistics(BaseModel):
    total_area: float
    high_stress_area: float
    medium_stress_area: float
    low_stress_area: float
    mean_ndvi: float
    num_regions: int
    cloud_coverage: float

class AnalysisResponse(BaseModel):
    success: bool
    data: Dict[str, Any]
    message: Optional[str] = None
```

#### 3. Endpoints FastAPI

**Health Check:**
```python
# app/api/routes/health.py
from fastapi import APIRouter

router = APIRouter()

@router.get("/health", tags=["Health"])
async def health_check():
    """Health check endpoint"""
    return {"status": "ok", "message": "Server is running"}

@router.get("/api/analysis/test", tags=["Health"])
async def test_sentinel_hub():
    """Test Sentinel Hub connection"""
    from app.services.sentinel_hub_service import SentinelHubService
    
    service = SentinelHubService()
    result = service.test_connection()
    
    return {"success": True, "data": result}
```

**Analysis:**
```python
# app/api/routes/analysis.py
from fastapi import APIRouter, HTTPException
from app.api.schemas.requests import AnalysisRequest
from app.api.schemas.responses import AnalysisResponse
from app.services.region_growing_service import RegionGrowingService

router = APIRouter()

@router.post("/analyze", response_model=AnalysisResponse)
async def analyze_region(request: AnalysisRequest):
    """
    Analiza una regiÃ³n geogrÃ¡fica para detectar estrÃ©s vegetal
    
    - **bbox**: Bounding box con coordenadas geogrÃ¡ficas
    - **date_from**: Fecha inicio (opcional)
    - **date_to**: Fecha fin (opcional)
    - **method**: MÃ©todo de anÃ¡lisis (classic o hybrid)
    """
    try:
        service = RegionGrowingService()
        
        result = service.analyze_stress(
            bbox=request.bbox.model_dump(),
            date_from=request.date_from,
            date_to=request.date_to
        )
        
        return AnalysisResponse(success=True, data=result)
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```


#### 4. Main App

```python
# app/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.api.routes import health, analysis
from config.config import Settings

settings = Settings()

app = FastAPI(
    title=settings.app_name,
    description="API para comparaciÃ³n de Region Growing ClÃ¡sico vs SemÃ¡ntico",
    version=settings.app_version,
    docs_url="/api/docs",
    redoc_url="/api/redoc"
)

# CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.cors_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Routes
app.include_router(health.router, tags=["Health"])
app.include_router(analysis.router, prefix="/api/analysis", tags=["Analysis"])

@app.on_event("startup")
async def startup_event():
    """Validar configuraciÃ³n al iniciar"""
    try:
        if not settings.sentinel_hub_client_id:
            print("[WARNING] Sentinel Hub credentials not configured")
        else:
            print("[OK] Configuration validated")
    except Exception as e:
        print(f"[ERROR] Configuration error: {e}")
```

#### 5. Poetry Configuration

```toml
# pyproject.toml
[tool.poetry]
name = "vision-backend"
version = "2.0.0"
description = "Sistema HÃ­brido de DetecciÃ³n de EstrÃ©s Vegetal - Backend FastAPI"
authors = ["Equipo 24 <equipo24@example.com>"]
readme = "README.md"
python = "^3.11"

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.109.0"
uvicorn = {extras = ["standard"], version = "^0.27.0"}
pydantic = "^2.5.0"
pydantic-settings = "^2.1.0"

# Sentinel Hub
sentinelhub = "^3.10.2"

# Image Processing
numpy = "^2.3.0"
opencv-python = "^4.9.0"
pillow = "^10.0.0"
scipy = "^1.11.0"

# Geospatial
shapely = "^2.0.0"
pyproj = "^3.6.0"
geojson = "^3.0.0"

# Utilities
python-dotenv = "^1.0.0"
requests = "^2.31.0"
python-dateutil = "^2.8.0"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.0"
pytest-asyncio = "^0.23.0"
httpx = "^0.26.0"
black = "^23.12.0"
ruff = "^0.1.9"

[tool.poetry.group.test.dependencies]
pytest-cov = "^4.1.0"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 100
target-version = ['py311']

[tool.ruff]
line-length = 100
target-version = "py311"
```

---

## ğŸ”„ Plan de MigraciÃ³n Paso a Paso

### Fase 1: PreparaciÃ³n (30 min)

**1.1 Instalar Poetry**
```bash
# Windows (PowerShell)
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -

# Linux/Mac
curl -sSL https://install.python-poetry.org | python3 -

# Verificar instalaciÃ³n
poetry --version
```

**1.2 Inicializar Poetry en el proyecto**
```bash
cd backend
poetry init --no-interaction
```

**1.3 Agregar dependencias principales**
```bash
poetry add fastapi uvicorn[standard] pydantic pydantic-settings
poetry add sentinelhub numpy opencv-python pillow scipy
poetry add shapely pyproj geojson python-dotenv requests python-dateutil
```

**1.4 Agregar dependencias de desarrollo**
```bash
poetry add --group dev pytest pytest-asyncio httpx black ruff
poetry add --group test pytest-cov
```


### Fase 2: Crear Estructura FastAPI (45 min)

**2.1 Crear estructura de carpetas**
```bash
mkdir -p app/api/routes
mkdir -p app/api/schemas
mkdir -p tests
```

**2.2 Crear archivos base**
```bash
# __init__.py files
touch app/api/__init__.py
touch app/api/routes/__init__.py
touch app/api/schemas/__init__.py
touch tests/__init__.py

# Main files
touch app/main.py
touch app/api/routes/health.py
touch app/api/routes/analysis.py
touch app/api/schemas/requests.py
touch app/api/schemas/responses.py
```

**2.3 Implementar schemas Pydantic**
- Crear modelos de request en `app/api/schemas/requests.py`
- Crear modelos de response en `app/api/schemas/responses.py`
- Agregar validaciones con `field_validator`

**2.4 Migrar configuraciÃ³n a Pydantic Settings**
- Actualizar `config/config.py` para usar `BaseSettings`
- Mantener compatibilidad con `.env` existente
- Agregar validaciones de configuraciÃ³n

### Fase 3: Migrar Endpoints (60 min)

**3.1 Implementar health check**
- Crear `app/api/routes/health.py`
- Migrar endpoint `GET /health`
- Migrar endpoint `GET /api/analysis/test`

**3.2 Implementar analysis endpoints**
- Crear `app/api/routes/analysis.py`
- Migrar endpoint `POST /api/analysis/analyze`
- Adaptar para usar schemas Pydantic
- Mantener lÃ³gica de servicios sin cambios

**3.3 Crear main app**
- Implementar `app/main.py`
- Configurar CORS
- Registrar routers
- Agregar startup event

**3.4 Actualizar punto de entrada**
```python
# app.py
from app.main import app
from config.config import Settings
import uvicorn

settings = Settings()

if __name__ == '__main__':
    print(f"Starting FastAPI app")
    print(f"API running on http://localhost:{settings.port}")
    print(f"Swagger UI: http://localhost:{settings.port}/api/docs")
    print(f"ReDoc: http://localhost:{settings.port}/api/redoc")
    
    uvicorn.run(
        "app.main:app",
        host="0.0.0.0",
        port=settings.port,
        reload=settings.debug
    )
```

### Fase 4: Testing y ValidaciÃ³n (45 min)

**4.1 Crear tests bÃ¡sicos**
```python
# tests/test_health.py
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_health_check():
    response = client.get("/health")
    assert response.status_code == 200
    assert response.json()["status"] == "ok"

def test_sentinel_hub_test():
    response = client.get("/api/analysis/test")
    assert response.status_code == 200
```

```python
# tests/test_analysis.py
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_analyze_endpoint_validation():
    # Test sin bbox (debe fallar)
    response = client.post("/api/analysis/analyze", json={})
    assert response.status_code == 422
    
    # Test con bbox vÃ¡lido
    response = client.post("/api/analysis/analyze", json={
        "bbox": {
            "min_lat": -12.05,
            "min_lon": -77.05,
            "max_lat": -11.95,
            "max_lon": -76.95
        }
    })
    assert response.status_code in [200, 500]  # 500 si no hay credenciales
```

**4.2 Ejecutar tests**
```bash
poetry run pytest tests/ -v
poetry run pytest --cov=app --cov-report=html
```

**4.3 Validar endpoints manualmente**
```bash
# Iniciar servidor
poetry run python app.py

# En otra terminal, probar endpoints
curl http://localhost:8000/health
curl http://localhost:8000/api/analysis/test

# Abrir Swagger UI en navegador
# http://localhost:8000/api/docs
```

**4.4 Verificar documentaciÃ³n automÃ¡tica**
- Abrir `/api/docs` (Swagger UI)
- Verificar que todos los endpoints aparecen
- Probar "Try it out" en cada endpoint
- Verificar que los schemas se muestran correctamente


### Fase 5: Limpieza y DocumentaciÃ³n (30 min)

**5.1 Eliminar cÃ³digo Flask obsoleto**
```bash
# Respaldar por si acaso
git add .
git commit -m "chore: backup before removing Flask code"

# Eliminar dependencias Flask de requirements.txt (mantener archivo para referencia)
# NO eliminar servicios, solo controllers antiguos si es necesario
```

**5.2 Actualizar README.md**
- Cambiar instrucciones de instalaciÃ³n a Poetry
- Actualizar comandos de ejecuciÃ³n
- Actualizar URLs de documentaciÃ³n
- Agregar secciÃ³n de migraciÃ³n

**5.3 Actualizar .env.example**
```env
# App
APP_NAME="Sistema HÃ­brido de DetecciÃ³n de EstrÃ©s Vegetal"
APP_VERSION="2.0.0"
DEBUG=True
PORT=8000

# CORS (separar mÃºltiples con comas)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# Sentinel Hub
SENTINEL_HUB_CLIENT_ID=your-client-id
SENTINEL_HUB_CLIENT_SECRET=your-client-secret
```

**5.4 Formatear cÃ³digo**
```bash
poetry run black .
poetry run ruff check . --fix
```

---

## ğŸ§ª Criterios de ValidaciÃ³n

### Tests Automatizados

```bash
# Todos los tests deben pasar
poetry run pytest tests/ -v

# Coverage mÃ­nimo 70%
poetry run pytest --cov=app --cov-report=term-missing
```

### Tests Manuales

**1. Health Check**
```bash
curl http://localhost:8000/health
# Esperado: {"status": "ok", "message": "Server is running"}
```

**2. Swagger UI**
```
Abrir: http://localhost:8000/api/docs
Verificar:
- Todos los endpoints listados
- Schemas visibles
- "Try it out" funciona
```

**3. AnÃ¡lisis de regiÃ³n**
```bash
curl -X POST http://localhost:8000/api/analysis/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "bbox": {
      "min_lat": -12.05,
      "min_lon": -77.05,
      "max_lat": -11.95,
      "max_lon": -76.95
    }
  }'
```

**4. ValidaciÃ³n Pydantic**
```bash
# Debe retornar error 422 con detalles
curl -X POST http://localhost:8000/api/analysis/analyze \
  -H "Content-Type: application/json" \
  -d '{"bbox": {"min_lat": 100}}'
```

### Checklist de Calidad

- [ ] CÃ³digo formateado con Black
- [ ] Sin warnings de Ruff
- [ ] Type hints en todas las funciones
- [ ] Docstrings en funciones pÃºblicas
- [ ] Tests con coverage >70%
- [ ] Swagger UI funcional
- [ ] CORS configurado correctamente
- [ ] Variables de entorno documentadas
- [ ] README actualizado
- [ ] Commits siguiendo Conventional Commits

---

## ğŸ“Š MÃ©tricas de Ã‰xito

### Performance

| MÃ©trica | Flask | FastAPI | Mejora |
|---------|-------|---------|--------|
| Requests/seg | ~500 | ~1500-2000 | 3-4x |
| Latencia promedio | ~20ms | ~5-8ms | 2.5-4x |
| Tiempo startup | ~2s | ~0.5s | 4x |

### Developer Experience

| Aspecto | Antes | DespuÃ©s |
|---------|-------|---------|
| DocumentaciÃ³n API | Manual (flasgger) | AutomÃ¡tica |
| ValidaciÃ³n | Manual | AutomÃ¡tica |
| Type safety | Opcional | Obligatorio |
| Testing | unittest | TestClient integrado |
| Hot reload | SÃ­ | SÃ­ (mÃ¡s rÃ¡pido) |

---

## ğŸš¨ Riesgos y Mitigaciones

### Riesgo 1: Incompatibilidad de dependencias
**Probabilidad:** Media  
**Impacto:** Alto  
**MitigaciÃ³n:**
- Poetry resuelve dependencias automÃ¡ticamente
- Probar instalaciÃ³n en entorno limpio
- Mantener `requirements.txt` como backup

### Riesgo 2: Servicios existentes no funcionan con async
**Probabilidad:** Baja  
**Impacto:** Medio  
**MitigaciÃ³n:**
- Los servicios actuales son sÃ­ncronos y funcionan en FastAPI
- FastAPI soporta funciones sÃ­ncronas y asÃ­ncronas
- Migrar a async es opcional (mejora futura)

### Riesgo 3: CORS mal configurado
**Probabilidad:** Baja  
**Impacto:** Alto (bloquea frontend)  
**MitigaciÃ³n:**
- Probar con frontend desde el inicio
- ConfiguraciÃ³n flexible desde .env
- Documentar configuraciÃ³n claramente

### Riesgo 4: Tiempo de migraciÃ³n excede estimaciÃ³n
**Probabilidad:** Media  
**Impacto:** Medio  
**MitigaciÃ³n:**
- Plan detallado con tiempos por fase
- Priorizar funcionalidad core primero
- DocumentaciÃ³n puede completarse despuÃ©s

---

## ğŸ“ Notas de ImplementaciÃ³n

### Compatibilidad con Servicios Existentes

Los servicios actuales NO requieren cambios:
- `sentinel_hub_service.py` - Mantener sin cambios
- `ndvi_service.py` - Mantener sin cambios
- `region_growing_algorithm.py` - Mantener sin cambios
- `region_growing_service.py` - Mantener sin cambios
- `geo_converter_service.py` - Mantener sin cambios

Solo cambiar la capa de presentaciÃ³n (controllers â†’ routes).

### Async vs Sync

**Fase 1 (esta US):** Mantener servicios sÃ­ncronos
```python
@router.post("/analyze")
def analyze_region(request: AnalysisRequest):  # FunciÃ³n sÃ­ncrona
    service = RegionGrowingService()
    result = service.analyze_stress(...)  # Llamada sÃ­ncrona
    return result
```

**Fase 2 (futuro):** Migrar a async para mejor performance
```python
@router.post("/analyze")
async def analyze_region(request: AnalysisRequest):  # FunciÃ³n asÃ­ncrona
    service = RegionGrowingService()
    result = await service.analyze_stress_async(...)  # Llamada asÃ­ncrona
    return result
```


### EstÃ¡ndares AGENTS.md

Seguir estrictamente:

**CÃ³digo:**
- âœ… Nombres en inglÃ©s
- âœ… Type hints obligatorios
- âœ… Docstrings estilo Google
- âœ… Sin emojis en comentarios
- âœ… Formateo con Black (line-length=100)

**Commits:**
```bash
feat(api): migrate Flask to FastAPI
feat(config): add Pydantic Settings
feat(schemas): add request/response models
test(api): add endpoint tests
docs(readme): update installation instructions
```

**Testing:**
- âœ… Coverage mÃ­nimo 70%
- âœ… Tests unitarios para schemas
- âœ… Tests de integraciÃ³n para endpoints
- âœ… Usar TestClient de FastAPI

---

## ğŸ¯ DefiniciÃ³n de "Done"

Esta US se considera completada cuando:

1. **Funcionalidad:**
   - [x] Servidor FastAPI inicia sin errores
   - [x] Todos los endpoints responden correctamente
   - [x] Swagger UI accesible y funcional
   - [x] CORS permite requests desde frontend

2. **Calidad:**
   - [x] Tests automatizados pasan (>70% coverage)
   - [x] CÃ³digo formateado con Black
   - [x] Sin warnings de Ruff
   - [x] Type hints en todas las funciones pÃºblicas

3. **DocumentaciÃ³n:**
   - [x] README actualizado con instrucciones Poetry
   - [x] Swagger docs generado automÃ¡ticamente
   - [x] .env.example actualizado
   - [x] Comentarios en cÃ³digo complejo

4. **IntegraciÃ³n:**
   - [x] Frontend puede conectarse al backend
   - [x] Servicios existentes funcionan sin cambios
   - [x] Variables de entorno compatibles

5. **Git:**
   - [x] Commits siguiendo Conventional Commits
   - [x] Branch `feature/us-001-fastapi-migration` creado
   - [x] Pull Request creado con descripciÃ³n detallada
   - [x] Code review aprobado

---

## ğŸ“š Referencias

### DocumentaciÃ³n Oficial
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Pydantic Documentation](https://docs.pydantic.dev/)
- [Poetry Documentation](https://python-poetry.org/docs/)
- [Uvicorn Documentation](https://www.uvicorn.org/)

### Tutoriales Relevantes
- [FastAPI Tutorial - First Steps](https://fastapi.tiangolo.com/tutorial/first-steps/)
- [Pydantic Settings Management](https://docs.pydantic.dev/latest/concepts/pydantic_settings/)
- [Poetry Dependency Management](https://python-poetry.org/docs/dependency-specification/)

### Ejemplos de CÃ³digo
- [FastAPI Full Stack Template](https://github.com/tiangolo/full-stack-fastapi-template)
- [FastAPI Best Practices](https://github.com/zhanymkanov/fastapi-best-practices)

---

## ğŸ”— Dependencias

### Bloqueantes (debe completarse antes de):
- US-002: Migrar Frontend a Nuxt 3 (necesita backend funcionando)
- US-003: Descargar imÃ¡genes Sentinel-2 (necesita estructura FastAPI)
- US-004: Implementar Region Growing clÃ¡sico (necesita endpoints)

### Desbloqueadas por:
- Ninguna (primera US del sprint)

---

## ğŸ‘¥ Equipo y Roles

**Desarrollador Principal:** Carlos Bocanegra
- ImplementaciÃ³n de FastAPI
- MigraciÃ³n de endpoints
- ConfiguraciÃ³n de Poetry

**Revisor de CÃ³digo:** Arthur Zizumbo
- Code review
- ValidaciÃ³n de arquitectura
- Testing

**Tester:** Luis VÃ¡zquez
- Pruebas de integraciÃ³n con frontend
- ValidaciÃ³n de CORS
- DocumentaciÃ³n de API

---

## ğŸ“… Timeline Detallado

| Fase | DuraciÃ³n | Inicio | Fin | Responsable |
|------|----------|--------|-----|-------------|
| 1. PreparaciÃ³n | 30 min | 09:00 | 09:30 | Carlos |
| 2. Estructura FastAPI | 45 min | 09:30 | 10:15 | Carlos |
| 3. Migrar Endpoints | 60 min | 10:15 | 11:15 | Carlos |
| Break | 15 min | 11:15 | 11:30 | - |
| 4. Testing | 45 min | 11:30 | 12:15 | Carlos + Arthur |
| 5. Limpieza | 30 min | 12:15 | 12:45 | Carlos |
| Code Review | 15 min | 12:45 | 13:00 | Arthur |

**Total:** 4 horas (incluyendo break y review)

---

## âœ… Checklist de EjecuciÃ³n

### Pre-implementaciÃ³n
- [ ] Leer y entender completamente esta US
- [ ] Revisar documentaciÃ³n de FastAPI
- [ ] Verificar que Poetry estÃ¡ instalado
- [ ] Crear branch `feature/us-001-fastapi-migration`
- [ ] Backup del cÃ³digo actual

### Durante implementaciÃ³n
- [ ] Seguir plan paso a paso
- [ ] Hacer commits frecuentes
- [ ] Probar cada endpoint despuÃ©s de migrarlo
- [ ] Documentar problemas encontrados

### Post-implementaciÃ³n
- [ ] Ejecutar todos los tests
- [ ] Formatear cÃ³digo con Black
- [ ] Verificar con Ruff
- [ ] Actualizar README
- [ ] Crear Pull Request
- [ ] Solicitar code review
- [ ] Mergear a main despuÃ©s de aprobaciÃ³n

---

## ğŸ“ Aprendizajes Esperados

Al completar esta US, el equipo habrÃ¡ aprendido:

1. **FastAPI:**
   - Estructura de aplicaciÃ³n FastAPI
   - Routers y dependency injection
   - DocumentaciÃ³n automÃ¡tica con OpenAPI

2. **Pydantic:**
   - ValidaciÃ³n de datos con schemas
   - Settings management
   - Custom validators

3. **Poetry:**
   - GestiÃ³n moderna de dependencias Python
   - Lock files y reproducibilidad
   - Grupos de dependencias

4. **Async Python:**
   - Diferencia entre WSGI y ASGI
   - CuÃ¡ndo usar async/await
   - Performance benefits

5. **API Design:**
   - RESTful best practices
   - Error handling
   - CORS configuration

---

## ğŸ’¡ Mejoras Futuras (Fuera del Scope)

Estas mejoras NO son parte de esta US pero pueden considerarse despuÃ©s:

1. **Async Services:** Migrar servicios a async para mejor performance
2. **Background Tasks:** Usar FastAPI BackgroundTasks para anÃ¡lisis largos
3. **WebSockets:** Streaming de progreso en tiempo real
4. **Rate Limiting:** Limitar requests por IP
5. **Authentication:** JWT tokens para seguridad
6. **Caching:** Redis para cachear resultados
7. **Monitoring:** Prometheus + Grafana
8. **Docker:** ContainerizaciÃ³n completa

---

## ğŸ“ Contacto y Soporte

**Dudas tÃ©cnicas:**
- Carlos Bocanegra (Backend Lead)
- Arthur Zizumbo (ML/Architecture)

**DocumentaciÃ³n:**
- Ver `backend/README.md` actualizado
- Swagger UI: `http://localhost:8000/api/docs`

**Issues:**
- Reportar en GitHub Issues con label `us-001`

---

**Documento creado:** Noviembre 2025  
**VersiÃ³n:** 1.0  
**Autor:** Equipo 24 - Region Growing  
**Estado:** Aprobado para implementaciÃ³n âœ…

